version: '3.8'

services:
  # Shared UI Components Library
  ui-components:
    build: ./ui-components
    container_name: microfrontend-ui-components
    ports:
      - "3005:3005"
    networks:
      - microfrontends-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3005"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Accounts Microfrontend (Depende de ui-components)
  mf-accounts:
    build: ./mf-accounts
    container_name: microfrontend-accounts
    ports:
      - "3001:3001"
    networks:
      - microfrontends-network
    depends_on:
      - ui-components
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3001"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Transactions Microfrontend (Depende de ui-components)
  mf-transactions:
    build: ./mf-transactions
    container_name: microfrontend-transactions
    ports:
      - "3002:3002"
    networks:
      - microfrontends-network
    depends_on:
      - ui-components
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3002"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Movements Microfrontend (Depende de ui-components)
  mf-movements:
    build: ./mf-movements
    container_name: microfrontend-movements
    ports:
      - "3003:3003"
    networks:
      - microfrontends-network
    depends_on:
      - ui-components
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3003"]
      interval: 30s
      timeout: 10s
      retries: 3

  # User Preferences Microfrontend (Depende de ui-components)
  mf-user-preferences:
    build: ./mf-user-preferences
    container_name: microfrontend-user-preferences
    ports:
      - "3004:3004"
    networks:
      - microfrontends-network
    depends_on:
      - ui-components
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3004"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Shell - Main Container (Module Federation Host)
  shell:
    build: ./shell
    container_name: microfrontend-shell
    ports:
      - "3000:3000"
    networks:
      - microfrontends-network
    depends_on:
      - ui-components
      - mf-accounts
      - mf-transactions
      - mf-movements
      - mf-user-preferences
    restart: unless-stopped
    environment:
      - NODE_ENV=development

# Red personalizada para comunicaci√≥n entre microfrontends
networks:
  microfrontends-network:
    driver: bridge
    name: microfrontends-net